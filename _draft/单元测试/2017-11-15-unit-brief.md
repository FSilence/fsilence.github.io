# 单元测试概述
通常我们为了验证自己的代码正确性，都会通过运行程序进行验证。但是这样有很多边界条件我们很难满足。我们很难保证程序在各个边界条件上的正常运行。这时候我们就会想到单元测试。

## 什么是单元测试
在计算机编程中，单元测试（英语：Unit Testing）又称为模块测试, 是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。 程序单元是应用的最小可测试部件。 在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。
  
通常我们可以按照单元测试的验证方式将单元测试分为结果测试和过程测试。  
**结果测试**  
验证测试的结果是否和预期一样， eq:  

```java
@Test
public void testA() {
   assertEquals(4，2+2)	
}
```

我们验证 2+2的运行结果是否是4    

**过程测试**  
验证方法执行中是否按照预期调用了其它方法，eq:  

```java
class A {
  public int add(int num1, int num2) {
    return num1 + num2;
  }
}

class B {
  A a;
  public B(A a) {
    this.a = a;
  }

  public void add(int num1, int num2) {
     a.add(num1, num2);
  }	
}
@Test
public void testB() {
   //创建一个Mock对象
   A a = mock(A.class);
   //注入到B中
   B b = new B(a);
   //调用B的add方法
   b.add(2, 2);
   //验证A的add方法被调用一次
   verify(a).add(2, 2);   	
}
``` 

关于上述实例中使用的mock 和 verify是Mockito（一个转本提供Mock对象的库）的语法。我们在这不做阐述。  
通常如果能做结果测试我们不会去进行过程测试，因为方法变动往往会到这过程测试失败，需要重新编写过程测试。 


## 为什么做单元测试  
1.保证代码质量  
验证代码运行结果, 保证代码可以得到预期结果

2.安心重构  
重构代码时候可以通过单元测试的正常运行，保证没有改变原有的结果。  
我们经常会去修改别人的代码，这时候我们很难保证没有修改了其他人的意图，如果有单元测试，我们可以通过单元测试是否正常运行来保证不会影响原有的行为。  

3.推动架构调整  
为了进行单元测试室，我们需要合理的架构解耦，需要提供对象的依赖注入， 使方法只进行一件事，崔进代码的合理性。    

4.方便调试  
在单元测试的时候我们可以debug，并设置一定的条件，而非需要运行程序。在调试一些很难触发的边界条件是尤为方便高效。    

5.方便定位问题  
将问题的粒度细化，更容易定位问题出现的地方。

## 单元测试的缺点
1.通常一个方法要写3-5个对应的测试方法（覆盖条件） 
例如

```java
public void function() {
   if (条件A) {
     ....
   } else if(条件B){
     ....
   } else {
     ....
   }
}
```
为了覆盖所有的条件，function方法会对应有3个测试方法，分别验证 条件A 条件B和else是否符合预期  
  
2.要随代码变动调整  
结果测试优于过程的测试的一个很重要的点， 就是代码变动往往会导致过程测试需要重构，例如上面的过程测试demo中 如果B中不再直接调用A的add方法，而是直接 num1 + num2， 那么对应的单元测试也要调整  
  
3.单元测试本身有可能有问题  
单元测试本身也是代码， 它是测试代码的代码，如果测试代码有问题， 就会导致严重问题。不过单元测试的代码要比产品代码简单的多， 这样我们就把保证产品代码的正确性转变成了保证单元测试代码准确性，降低了编码的难度。  


## 什么地方做单元测试
之前看到过比较极端的说法是，没有进行过单元测试的方法都是不安全的。通常我理解我们需要在带有if else 或者 switch分支的方法进行单元测试， 通常85%的覆盖率是比较完美的（我们以百分之百为目标，通常可以达到这个覆盖率）， 移动端由于包含大量的UI，而UI部分是变动比较频繁的通常不会对它进行单元测试，因此移动端的完美的单元测试覆盖率还会降低，根据个人经验预计Android端能达到百分五十就是非常完美的了。当然通常这个会随着项目类型有所变化，通常我们不必关注这个，我们只要朝着百分之百的覆盖率努力即可。  



